# 주소창에 URL을 입력했을때 일어나는 일

1. 브라우저의 url 파싱
url을 입력 받은 브라우저는 일단 url의 구조를 해석한다.<br>
어떤 프로토콜로 어느 도메인으로 어떤 포트로 보낼지를 해석한다.
    - https : protocol
    - www.naver.com : url
    - :443 : port

포트를 선언하지 않았다면 브라우저는 설정된 기본값을 이용해 요청한다.<br>
http : 80, https : 443<br>

2. url을 ip주소로 변환

도메인 주소를 컴퓨터가 읽을 수 있는 ip주소로 변환해야 서로 통신이 가능하다.<br>
우선 로컬 hosts 파일과 브라우저 캐시에 해당 url이 존재하는지 확인한다.<br>
존재하지 않는다면 DNS 서버에 요청하여 해당 url을 ip주소로 변환한다.

3. 라우터를 통해 해당 서버의 게이트웨이까지 이동

DNS 서버에게 받은 ip주소에 해당하는 서버로 요청을 보낸다.<br>
라우터에서 라우팅 테이블을 통해 해당 요청이 어떤 경로를 통해 가야할지 경로를 지정해준다.

4. 주소 결정 프로토콜 ARP를 통해 IP주소를 물리 주소인 MAC주소로 변환

5. 대상 서버와 tcp 소켓 연결, 암호화 통신을 위한 TLS 핸드쉐이킹 추가

6. HTTP(HTTPS) 프로토콜로 요청 및 응답

7. 서버에서 응답한 내용은 HTML, CSS, JS 로 이루어져 있으며 이를 브라우저가 해석한다.

## 브라우저가 HTML을 처리하는 방법

1. DOM 트리 구성

마크업 언어로 만들어진 문자열을 메모리에서 다루기 위해 HTML parser로 parsing하고 결과를 로딩.<br>
메모리에 만들어진 객체를 document라 하고 , 구조를 DOM이라 한다.<br>
HTML이라는 구조를 표현하는데 적합한 트리구조의 DOM을 만들어낸다.

1. 렌더트리 구성

HTML이 parsing되는 동안 실제로 화면을 구성하는 렌더링 엔진을 통해서 화면에 나오는 구조를 만들어 낸다.<br>
이렇게 만들어지는 구조를 렌더트리라고 한다.<br>
즉 현재 화면에 나와야 하는 요소들만 추려서 만들어진 부분을 말한다.
CSS가 HTML 문서의 위쪽에 있으면 렌더링 엔진이 기준을 빨리 제공 할 수 있어 렌더 트리 구성이 쉬워진다.

3. 레이아웃 처리와 페인팅

화면에 보여질 요소들을 파악한 렌더트리는 CSS를 이용해 위치를 결정한다.<br>

4. 리플로우 또는 요소의 변경

리플로우가 발생하면 이전에 이미 파싱되었던 html문서를 다시 파싱하지는 않으며, 레이아웃을 다시 계산하기 위해 렌더트리를 재구성하게 된다.<br>
이를 기반이로 레이아웃과 페인트 과정이 다시 일어난다.<br><br>

javascript에 의해 dom 요소가 변경되거나 삭제되는 경우에도 이미 파싱되었던 html문서를 다시 파싱하지는 않으며 이미 구성된 DOM트리에서 변경되거나 제거된 요소를 반영하여 다시 렌더트리를 구성하고 화면을 그리게 된다.

**자바스크립트 실행**<br>
HTML 데이터는 DOM트리로 구성되어 나중에 처리되는 반면에 script태그의 내용은 자바스크립트 엔진에 의해 바로 해석되어 실행된다.<br>
자바스크립트는 모든 작업을 멈추고 처리를 하는 방식으로 실행되기 때문에 DOM이나 렌더트리 구성을 최대한 진행한 다음에 자바스크립트가 실행되도록 JS코드를 HTML문서 하단에 위치한다.<br><br>
JQuery의 경우 $(document).ready() 메서드를 이용하여 DOM 구성이 끝난 상태에 이벤트를 감지하고 동작하여 성능 저하를 막는다.

### async vs defer

웹사이트가 자바스크립트에 의존적인 사이트라면 하단에 JS코드를 위치하는 것만으로도 해결이 어렵다.<br><br>
async를 활용하면 JS코드의 fetching과 HTML parsing이 병렬적으로 일어나며 JS코드가 실행될때만 HTML parsing이 멈춘다.<br><br>
defer을 활용하면 fetching만 병렬적으로 일어나며 HTML의 parsing이 끝난 후에 JS코드가 실행된다.<br>